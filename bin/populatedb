#!/usr/bin/env coffee

exec = require('child_process').exec

exec "rm -rf #{__dirname}/../db/metrics && mkdir #{__dirname}/../db/metrics", (err, stdout, stderr) ->
  if err then throw err

  # Require after rm and mkdir or DB is deleted once in callback
  metrics = require '../src/metrics'

  console.log 'Creating users'

  users = [
    {
      user: "admin",
      pass: "password",
    },
    {
      user: "superadminsystem",
      pass: "azerty",
    },
    {
      user: "warrior",
      pass: "warrior",
    },
    {
      user: "mickey",
      pass: "mickey"
    },
    {
      user: "vivelece",
      pass: "vivelece"
    }
  ]

  for generated_user, index in users
    console.log "Saving users #{index + 1}"
    user.save generated_user.user, generated_user.pass, (err) ->
      return err if err
